<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>New Habit</title>
    <meta name="description" content="Create new Habit">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="./habitz.css">
    <script type="text/javascript" src="./habitz.js"></script>
</head>

<body>
    <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    <div class="headline"><a href="/">New Habit</a></div>
    <form>
        <!-- <div class="row"><input type="text" name="user" id="user" placeholder="Name"></div> -->
        <div class="row"><input type="text" name="habit" id="habit" placeholder="Do 100 pushups"></div>
        <div class="row">
            <label class="container">mondays
                <input type="checkbox" checked="checked" name="monday" id="monday">
                <span class="checkmark"></span>
            </label>
            <label class="container">tuesdays
                <input type="checkbox" checked="checked" name="tuesday" id="tuesday">
                <span class="checkmark"></span>
            </label>
            <label class="container">wednesdays
                <input type="checkbox" checked="checked" name="wednesday" id="wednesday">
                <span class="checkmark"></span>
            </label>
            <label class="container">thursdays
                <input type="checkbox" checked="checked" name="thursday" id="thursday">
                <span class="checkmark"></span>
            </label>
            <label class="container">fridays
                <input type="checkbox" checked="checked" name="friday" id="friday">
                <span class="checkmark"></span>
            </label>
            <label class="container">saturdays
                <input type="checkbox" checked="checked" name="saturday" id="saturday">
                <span class="checkmark"></span>
            </label>
            <label class="container">sundays
                <input type="checkbox" checked="checked" name="sunday" id="sunday">
                <span class="checkmark"></span>
            </label>
        </div>
        <div class="row">
            <button type="button" onclick="createHabit();return false;">Create new Habit!</button>
        </div>
    </form>
    <script async defer>
        function createHabit() {
            // Validate form
            habit = document.getElementById('habit').value;

            // Collect checked weekdays
            weekdays = [
                document.getElementById('monday').checked ? "monday" : "",
                document.getElementById('tuesday').checked ? "tuesday" : "",
                document.getElementById('wednesday').checked ? "wednesday" : "",
                document.getElementById('thursday').checked ? "thursday" : "",
                document.getElementById('friday').checked ? "friday" : "",
                document.getElementById('saturday').checked ? "saturday" : "",
                document.getElementById('sunday').checked ? "sunday" : ""
            ]

            // Remove unchecked days
            for (var i = weekdays.length - 1; i >= 0; i--) {
                if (weekdays[i].length == "") {
                    weekdays.splice(i, 1);
                }
            }

            // We need at least 1 day
            if (weekdays.length == 0) {
                console.log("weekdays empty")
                return
            }

            // Prepare body
            body = {
                "habit": habit,
                "weekdays": weekdays,
            }

            console.log("Body:", body)

            POST("/v1", body, function(status, payload){
                document.location.href = "/today.html";
            })
        }
    </script>
</body>

</html>